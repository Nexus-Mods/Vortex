{"version":3,"file":"index.js","mappings":"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","sources":["webpack://gamebryo-archive-invalidation/./src/bsaRedirection.ts","webpack://gamebryo-archive-invalidation/./src/constants.ts","webpack://gamebryo-archive-invalidation/./src/index.ts","webpack://gamebryo-archive-invalidation/./src/util/filesNewer.ts","webpack://gamebryo-archive-invalidation/./src/util/gameSupport.ts","webpack://gamebryo-archive-invalidation/./src/views/Settings.tsx","webpack://gamebryo-archive-invalidation/external commonjs2 \"bluebird\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"path\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"react\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"react-bootstrap\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"react-i18next\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"react-redux\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"vortex-api\"","webpack://gamebryo-archive-invalidation/external commonjs2 \"vortex-parse-ini\"","webpack://gamebryo-archive-invalidation/webpack/bootstrap","webpack://gamebryo-archive-invalidation/webpack/before-startup","webpack://gamebryo-archive-invalidation/webpack/startup","webpack://gamebryo-archive-invalidation/webpack/after-startup"],"sourcesContent":["import { REDIRECTION_FILE, REDIRECTION_MOD } from './constants';\nimport { archiveListKey, bsaVersion, defaultArchives, iniName,\n         iniPath, isSupported } from './util/gameSupport';\n\nimport Promise from 'bluebird';\nimport * as path from 'path';\nimport { actions, fs, selectors, types, util } from 'vortex-api';\nimport IniParser, { WinapiFormat } from 'vortex-parse-ini';\n\nfunction genIniTweaksIni(api: types.IExtensionApi): Promise<string> {\n  const gameId = selectors.activeGameId(api.store.getState());\n  const parser = new IniParser(new WinapiFormat() as any);\n  const archivesKey = archiveListKey(gameId);\n  return parser.read(iniPath(gameId))\n  .then(ini => {\n    let archives = defaultArchives(gameId);\n    if ((ini.data['Archive'] !== undefined) && (ini.data['Archive'][archivesKey] !== undefined)) {\n      archives = ini.data['Archive'][archivesKey];\n    }\n    return Promise.resolve(`[Archive]\nbInvalidateOlderFiles=1\nbUseArchives=1\n${archivesKey}=${REDIRECTION_FILE}, ${archives}`);\n  });\n}\n\nfunction enableBSARedirection(api: types.IExtensionApi): Promise<void> {\n  const store = api.store;\n  const gameMode = selectors.activeGameId(store.getState());\n\n  if (!isSupported(gameMode)) {\n    return Promise.resolve(undefined);\n  }\n\n  const gamePath: string = util.getSafe(\n      store.getState(),\n      ['settings', 'gameMode', 'discovered', gameMode, 'path'], undefined);\n\n  if (gamePath === undefined) {\n    // TODO: happened in testing, but how does one get here with no path configured?\n    return Promise.resolve(undefined);\n  }\n\n  const iniBaseName = path.basename(iniName(gameMode), '.ini');\n  const redirectionIni = `BSA Redirection [${iniBaseName}].ini`;\n\n  const mod: types.IMod = {\n    id: REDIRECTION_MOD,\n    state: 'installed',\n    attributes: {\n      name: REDIRECTION_MOD,\n    },\n    installationPath: REDIRECTION_MOD,\n    type: '',\n  };\n\n  const installPath = selectors.installPath(store.getState());\n  const iniTweaksPath = path.join(installPath, REDIRECTION_MOD, 'Ini Tweaks');\n\n  const invalidationPath = path.join(installPath, REDIRECTION_MOD, REDIRECTION_FILE);\n  const dummyFile = path.join(path.dirname(invalidationPath), 'dummy', 'dummy.dds');\n  const createDummy = () => fs.ensureDirWritableAsync(path.dirname(dummyFile))\n    .then(() => fs.writeFileAsync(dummyFile, '', { encoding: 'utf8' })\n    .catch(err => err.code !== 'EEXIST' ? Promise.reject(err) : Promise.resolve()));\n  const cleanupDummy = () => Promise.mapSeries([dummyFile, path.dirname(dummyFile)],\n    iter => fs.removeAsync(iter).catch(err => Promise.resolve()));\n\n  return new Promise((resolve, reject) => {\n    api.events.emit('create-mod', gameMode, mod, (error) => {\n      if (error !== null) {\n        return reject(error);\n      }\n      return resolve();\n    });\n  })\n    .then(() => createDummy())\n    .then(() => fs.ensureDirAsync(iniTweaksPath))\n    .then(() => fs.forcePerm(api.translate, () => {\n      return api.openArchive(invalidationPath, {\n        version: bsaVersion(gameMode).toString(),\n        create: true,\n      })\n        .then(archive =>\n          archive.addFile(path.join('dummy', path.basename(dummyFile)), dummyFile)\n            .then(() => archive.write()));\n    }, invalidationPath))\n    .then(() => cleanupDummy())\n    .then(() => genIniTweaksIni(api))\n    .then(data => fs.writeFileAsync(\n        path.join(iniTweaksPath, redirectionIni), data))\n    .then(() => {\n      const profile = selectors.activeProfile(store.getState());\n      store.dispatch(actions.setModEnabled(profile.id, REDIRECTION_MOD, true));\n      store.dispatch(actions.setINITweakEnabled(\n        gameMode, REDIRECTION_MOD, redirectionIni, true));\n    })\n    .catch(err => {\n      if (err['path'] === undefined) {\n        err['path'] = invalidationPath;\n      }\n      return Promise.reject(err);\n    });\n}\n\nexport function toggleInvalidation(api: types.IExtensionApi, gameMode: string): Promise<void> {\n  const mods = util.getSafe(api.store.getState(), ['persistent', 'mods', gameMode], {});\n  if (mods[REDIRECTION_MOD] !== undefined) {\n    api.events.emit('remove-mod', gameMode, REDIRECTION_MOD);\n    return Promise.resolve();\n  } else {\n    return enableBSARedirection(api)\n      .catch(util.NotSupportedError, err => {\n        api.showErrorNotification('Failed to add invalidation mod',\n          'The extension providing BSA support has been disabled or removed. '\n          + 'Without it, Vortex can\\'t provide BSA redirection.', {\n          allowReport: false,\n        });\n        api.events.emit('remove-mod', gameMode, REDIRECTION_MOD);\n      })\n      .catch(err => {\n        api.showErrorNotification('Failed to add invalidation mod', err);\n        api.events.emit('remove-mod', gameMode, REDIRECTION_MOD);\n      });\n  }\n}\n","export const REDIRECTION_MOD = 'Vortex Archive Invalidation';\nexport const REDIRECTION_FILE = 'Vortex - BSA Redirection.bsa';\n","import filesNewer from './util/filesNewer';\r\nimport { bsaVersion, fileFilter, iniPath, initGameSupport, isSupported, targetAge } from './util/gameSupport';\r\nimport Settings from './views/Settings';\r\n\r\nimport { toggleInvalidation } from './bsaRedirection';\r\nimport { REDIRECTION_MOD } from './constants';\r\n\r\nimport Promise from 'bluebird';\r\nimport I18next from 'i18next';\r\nimport * as path from 'path';\r\nimport {} from 'redux-thunk';\r\nimport { actions, fs, log, selectors, types, util } from 'vortex-api';\r\nimport {IniFile} from 'vortex-parse-ini';\r\n\r\nfunction testArchivesAge(api: types.IExtensionApi) {\r\n  const state: types.IState = api.store.getState();\r\n  const gameId = selectors.activeGameId(state);\r\n\r\n  if (!isSupported(gameId)) {\r\n    return Promise.resolve(undefined);\r\n  }\r\n\r\n  const gamePath: string = util.getSafe(\r\n      state,\r\n      ['settings', 'gameMode', 'discovered', gameId, 'path'], undefined);\r\n\r\n  if (gamePath === undefined) {\r\n    // TODO: happened in testing, but how does one get here with no path configured?\r\n    return Promise.resolve(undefined);\r\n  }\r\n\r\n  const game = util.getGame(gameId);\r\n  const dataPath = game.getModPaths(gamePath)[''];\r\n\r\n  const age = targetAge(gameId);\r\n  if (age === undefined) {\r\n    return Promise.resolve(undefined);\r\n  }\r\n\r\n  return filesNewer(dataPath, fileFilter(gameId), age)\r\n      .then((files: string[]) => {\r\n        if (files.length === 0) {\r\n          return Promise.resolve(undefined);\r\n        }\r\n\r\n        return Promise.resolve({\r\n          description: {\r\n            short: 'Loose files may not get loaded',\r\n            long:\r\n                'Due to oddities in the game engine, some loose files will not ' +\r\n                'get loaded unless we change the filetime on the vanilla BSA/BA2 files. ' +\r\n                'There is no drawback to doing this.',\r\n          },\r\n          severity: 'warning',\r\n          automaticFix: () => new Promise<void>(\r\n                  (fixResolve, fixReject) =>\r\n                      Promise.map(files, file => fs.utimesAsync(\r\n                                             path.join(dataPath, file),\r\n                                             age.getTime() / 1000,\r\n                                             age.getTime() / 1000))\r\n                          .then((stats: any) => {\r\n                            fixResolve();\r\n                            return Promise.resolve(undefined);\r\n                          })\r\n                          .catch(err => {\r\n                            api.store.dispatch(actions.addNotification({\r\n                              type: 'error',\r\n                              title: 'Failed to change file times',\r\n                              message: err.code === 'EPERM'\r\n                                ? 'Game files are write protected'\r\n                                : err.message,\r\n                            }) as any);\r\n                            fixResolve();\r\n                          })),\r\n        });\r\n      })\r\n      .catch(util.UserCanceled, () => Promise.resolve(undefined))\r\n      .catch((err: Error) => {\r\n        api.showErrorNotification('Failed to read bsa/ba2 files.', err, {\r\n          allowReport: (err as any).code !== 'ENOENT',\r\n        });\r\n        return Promise.resolve(undefined);\r\n      });\r\n}\r\n\r\nfunction applyIniSettings(api: types.IExtensionApi,\r\n                          profile: types.IProfile,\r\n                          iniFile: IniFile<any>) {\r\n  if (iniFile.data.Archive === undefined) {\r\n    iniFile.data.Archive = {};\r\n  }\r\n  iniFile.data.Archive.bInvalidateOlderFiles = 1;\r\n  iniFile.data.Archive.sResourceDataDirsFinal = '';\r\n}\r\n\r\ninterface IToDoProps {\r\n  gameMode: string;\r\n  mods: { [id: string]: types.IMod };\r\n}\r\n\r\nfunction useBSARedirection(gameMode: string) {\r\n  return isSupported(gameMode) && (bsaVersion(gameMode) !== undefined);\r\n}\r\n\r\nfunction init(context: types.IExtensionContext): boolean {\r\n  initGameSupport(context.api);\r\n  context.registerTest('archive-backdate', 'gamemode-activated',\r\n                       () => testArchivesAge(context.api));\r\n\r\n  context.registerToDo(\r\n    'bsa-redirection', 'workaround',\r\n    (state: types.IState): IToDoProps => {\r\n      const gameMode = selectors.activeGameId(state);\r\n      return {\r\n        gameMode,\r\n        mods: util.getSafe(state, ['persistent', 'mods', gameMode], {}),\r\n      };\r\n    }, 'workaround',\r\n    'Archive Invalidation', (props: IToDoProps) => toggleInvalidation(context.api, props.gameMode),\r\n    (props: IToDoProps) => useBSARedirection(props.gameMode),\r\n    (t: typeof I18next.t, props: IToDoProps) => (\r\n      (props.mods[REDIRECTION_MOD] !== undefined) ? t('Yes') : t('No')\r\n    ),\r\n    undefined,\r\n  );\r\n\r\n  (context.registerSettings as any)('Workarounds', Settings, undefined, () =>\r\n    useBSARedirection(selectors.activeGameId(context.api.store.getState())),\r\n  );\r\n\r\n  context.once(() => {\r\n    context.api.onAsync('apply-settings',\r\n      (profile: types.IProfile, filePath: string, ini: IniFile<any>) => {\r\n        log('debug', 'apply AI settings', { gameId: profile.gameId, filePath });\r\n        if (isSupported(profile.gameId)\r\n            && (filePath.toLowerCase() === iniPath(profile.gameId).toLowerCase())) {\r\n          applyIniSettings(context.api, profile, ini);\r\n        }\r\n        return Promise.resolve();\r\n      });\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nexport default init;\r\n","import Promise from 'bluebird';\r\nimport * as path from 'path';\r\nimport { fs } from 'vortex-api';\r\n\r\n/**\r\n * find all files in a directory that match a certain name filter and are newer\r\n * than the specified age\r\n *\r\n * @param {string} gamePath\r\n * @param {(name: string) => boolean} nameFilter\r\n * @param {Date} minAge\r\n * @returns {Promise<string[]>}\r\n */\r\nfunction filesNewer(\r\n    searchPath: string,\r\n    nameFilter: (name: string) => boolean,\r\n    minAge: Date,\r\n  ): Promise<string[]> {\r\n  return fs.readdirAsync(searchPath)\r\n      .then((files: string[]) => {\r\n        // stat all files that match the name filter\r\n        const matches = files.filter(nameFilter);\r\n        return Promise.map(\r\n            matches, file => fs.statAsync(path.join(searchPath, file))\r\n                                 .then((stats: fs.Stats) => Promise.resolve({\r\n                                   name: file,\r\n                                   stats,\r\n                                 })));\r\n      })\r\n      .then((fileStats: Array<{ name: string, stats: fs.Stats }>) =>\r\n                fileStats.filter(file => file.stats.mtime > minAge)\r\n                         .map(file => file.name));\r\n}\r\n\r\nexport default filesNewer;\r\n","import * as path from 'path';\r\nimport * as Redux from 'redux';\r\nimport { selectors, types, util } from 'vortex-api';\r\n\r\ninterface IGameSupport {\r\n  fileFilter?: (fileName: string) => boolean;\r\n  targetAge?: Date;\r\n  bsaVersion?: number;\r\n  mygamesPath: string;\r\n  iniName: string;\r\n  archiveListKey: string;\r\n  defaultArchives: string[];\r\n}\r\n\r\nconst gameSupport = util.makeOverlayableDictionary<string, IGameSupport>({\r\n  skyrim: {\r\n    fileFilter: (fileName: string) => {\r\n      const fileNameL = fileName.toLowerCase();\r\n      return (path.extname(fileNameL) === '.bsa')\r\n        && (fileNameL.startsWith('skyrim - ')\r\n            || (fileNameL.startsWith('hearthfires'))\r\n            || (fileNameL.startsWith('dragonborn'))\r\n            || (fileNameL.startsWith('highrestexturepack'))\r\n          );\r\n    },\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'skyrim',\r\n    iniName: 'Skyrim.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Skyrim - Misc.bsa', 'Skyrim - Shaders.bsa', 'Skyrim - Textures.bsa',\r\n                      'Skyrim - Interface.bsa', 'Skyrim - Animations.bsa', 'Skyrim - Meshes.bsa',\r\n                      'Skyrim - Sounds.bsa'],\r\n  },\r\n  enderal: {\r\n    fileFilter: (fileName: string) => {\r\n      const fileNameL = fileName.toLowerCase();\r\n      return (path.extname(fileNameL) === '.bsa')\r\n        && (fileNameL.startsWith('skyrim - ')\r\n            || (fileNameL.startsWith('E - '))\r\n            || (fileNameL.startsWith('L - '))\r\n          );\r\n    },\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'enderal',\r\n    iniName: 'enderal.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Skyrim - Misc.bsa', 'Skyrim - Shaders.bsa', 'Skyrim - Textures.bsa',\r\n                      'Skyrim - Interface.bsa', 'Skyrim - Animations.bsa', 'Skyrim - Meshes.bsa',\r\n                      'Skyrim - Sounds.bsa',\r\n                      'E - Meshes.bsa', 'E - Music.bsa', 'E - Scripts.bsa', 'E - Sounds.bsa',\r\n                      'E - Textures1.bsa', 'E - Textures2.bsa', 'E - Textures3.bsa',\r\n                      'L - Textures.bsa', 'L - Voices.bsa'],\r\n  },\r\n  skyrimse: {\r\n    fileFilter: (fileName: string) =>\r\n      fileName.startsWith('Skyrim - ')\r\n      && path.extname(fileName).toLowerCase() === '.bsa',\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'Skyrim Special Edition',\r\n    iniName: 'Skyrim.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Skyrim - Misc.bsa', 'Skyrim - Shaders.bsa', 'Skyrim - Interface.bsa',\r\n                      'Skyrim - Animations.bsa', 'Skyrim - Meshes0.bsa',\r\n                      'Skyrim - Meshes1.bsa', 'Skyrim - Sounds.bsa'],\r\n  },\r\n  skyrimvr: {\r\n    fileFilter: (fileName: string) =>\r\n      fileName.startsWith('Skyrim - ')\r\n      && path.extname(fileName).toLowerCase() === '.bsa',\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'Skyrim VR',\r\n    iniName: 'SkyrimVR.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Skyrim - Misc.bsa', 'Skyrim - Shaders.bsa', 'Skyrim - Interface.bsa',\r\n                      'Skyrim - Animations.bsa', 'Skyrim - Meshes0.bsa', 'Skyrim - Meshes1.bsa',\r\n                      'Skyrim - Sounds.bsa'],\r\n  },\r\n  fallout4: {\r\n    fileFilter: (fileName: string) => {\r\n      const fileNameL = fileName.toLowerCase();\r\n      return path.extname(fileNameL) === '.ba2'\r\n          && (fileNameL.startsWith('fallout4 - ')\r\n              || fileNameL.startsWith('dlccoast - ')\r\n              || fileNameL.startsWith('dlcrobot - ')\r\n              || fileNameL.startsWith('dlcworkshop')\r\n              || fileNameL.startsWith('dlcnukaworld - ')\r\n        );\r\n      },\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'Fallout4',\r\n    iniName: 'Fallout4.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Fallout4 - Voices.ba2', 'Fallout4 - Meshes.ba2',\r\n                      'Fallout4 - MeshesExtra.ba2', 'Fallout4 - Misc.ba2',\r\n                      'Fallout4 - Sounds.ba2', 'Fallout4 - Materials.ba2'],\r\n  },\r\n  fallout4vr: {\r\n    fileFilter: (fileName: string) =>\r\n      (fileName.startsWith('Fallout4 - ') || (fileName.startsWith('Fallout4_VR - ')))\r\n      && path.extname(fileName).toLowerCase() === '.ba2',\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'Fallout4VR',\r\n    iniName: 'Fallout4Custom.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: ['Fallout4 - Voices.ba2', 'Fallout4 - Meshes.ba2',\r\n                      'Fallout4 - MeshesExtra.ba2', 'Fallout4 - Misc.ba2',\r\n                      'Fallout4 - Sounds.ba2', 'Fallout4 - Materials.ba2'],\r\n  },\r\n  fallout3: {\r\n    fileFilter: (fileName: string) =>\r\n      path.extname(fileName) === '.bsa'\r\n      && (fileName.startsWith('Fallout - ')\r\n          || fileName.startsWith('BrokenSteel - ')\r\n          || fileName.startsWith('Anchorage - ')\r\n          || fileName.startsWith('PointLookout - ')\r\n          || fileName.startsWith('Zeta - ')\r\n          || fileName.startsWith('ThePitt - ')),\r\n    targetAge: new Date(2006, 1, 1),\r\n    bsaVersion: 0x68,\r\n    mygamesPath: 'Fallout3',\r\n    iniName: 'Fallout.ini',\r\n    archiveListKey: 'SArchiveList',\r\n    defaultArchives: ['Fallout - Textures.bsa', 'Fallout - Meshes.bsa', 'Fallout - Voices.bsa',\r\n                      'Fallout - Sound.bsa', 'Fallout - MenuVoices.bsa', 'Fallout - Misc.bsa'],\r\n  },\r\n  falloutnv: {\r\n    fileFilter: (fileName: string) =>\r\n      path.extname(fileName) === '.bsa'\r\n      && (fileName.startsWith('Fallout - ')\r\n          || fileName.startsWith('DeadMoney -')\r\n          || fileName.startsWith('HonestHearts - ')\r\n          || fileName.startsWith('OldWorldBlues - ')\r\n          || fileName.startsWith('LonesomeRoad - ')\r\n          || fileName.startsWith('CaravanPack - ')\r\n          || fileName.startsWith('ClassicPack - ')\r\n          || fileName.startsWith('MercenaryPack - ')\r\n          || fileName.startsWith('TribalPack - ')\r\n          || fileName.startsWith('GunRunnersArsenal - ')),\r\n    targetAge: new Date(2006, 1, 1),\r\n    bsaVersion: 0x68,\r\n    mygamesPath: 'FalloutNV',\r\n    iniName: 'Fallout.ini',\r\n    archiveListKey: 'SArchiveList',\r\n    defaultArchives: ['Fallout - Textures.bsa', 'Fallout - Textures2.bsa', 'Fallout - Meshes.bsa',\r\n                      'Fallout - Voices1.bsa', 'Fallout - Sound.bsa', 'Fallout - Misc.bsa'],\r\n  },\r\n  starfield: {\r\n    fileFilter: (fileName: string) =>\r\n      (fileName.match(/(starfield - |sfbgs)/))\r\n      && path.extname(fileName).toLowerCase() === '.ba2',\r\n    targetAge: new Date(2008, 10, 1),\r\n    mygamesPath: 'Starfield',\r\n    iniName: 'StarfieldCustom.ini',\r\n    archiveListKey: 'SResourceArchiveList',\r\n    defaultArchives: [],\r\n  },\r\n  oblivion: {\r\n    fileFilter: (fileName: string) =>\r\n      path.extname(fileName) === '.bsa'\r\n      && (fileName.startsWith('Oblivion - ')\r\n          || fileName.startsWith('DLC')\r\n          || fileName.startsWith('Knights')),\r\n    targetAge: new Date(2006, 1, 1),\r\n    bsaVersion: 0x67,\r\n    mygamesPath: 'Oblivion',\r\n    iniName: 'Oblivion.ini',\r\n    archiveListKey: 'SArchiveList',\r\n    defaultArchives: ['Oblivion - Meshes.bsa', 'Oblivion - Textures - Compressed.bsa',\r\n                      'Oblivion - Sounds.bsa', 'Oblivion - Voices1.bsa',\r\n                      'Oblivion - Voices2.bsa', 'Oblivion - Misc.bsa'],\r\n  },\r\n}, {\r\n  gog: {\r\n    skyrimse: {\r\n      mygamesPath: 'Skyrim Special Edition GOG',\r\n    },\r\n    enderalspecialedition: {\r\n      mygamesPath: 'Enderal Special Edition GOG',\r\n    },\r\n  },\r\n  epic: {\r\n    skyrimse: {\r\n      mygamesPath: 'Skyrim Special Edition EPIC',\r\n    },\r\n    fallout4: {\r\n      mygamesPath: 'Fallout4 EPIC',\r\n    },\r\n  },\r\n  xbox: {\r\n    skyrimse: {\r\n      mygamesPath: 'Skyrim Special Edition MS',\r\n    },\r\n    fallout4: {\r\n      mygamesPath: 'Fallout4 MS',\r\n    },\r\n  },\r\n}, (gameId: string) => gameStoreForGame(gameId));\r\n\r\nlet gameStoreForGame: (gameId: string) => string = () => undefined;\r\n\r\nexport function initGameSupport(api: types.IExtensionApi) {\r\n  gameStoreForGame = (gameId: string) =>\r\n    selectors.discoveryByGame(api.store.getState(), gameId)?.store;\r\n}\r\n\r\nexport function isSupported(gameId: string): boolean {\r\n  return gameSupport.has(gameId);\r\n}\r\n\r\nfunction falseFunc() {\r\n  return false;\r\n}\r\n\r\nexport function fileFilter(gameId: string): (fileName: string) => boolean {\r\n  return gameSupport.get(gameId, 'fileFilter') ?? falseFunc;\r\n}\r\n\r\nexport function targetAge(gameId: string): Date {\r\n  return gameSupport.get(gameId, 'targetAge');\r\n}\r\n\r\nexport function bsaVersion(gameId: string): number {\r\n  return gameSupport.get(gameId, 'bsaVersion');\r\n}\r\n\r\nexport function mygamesPath(gameMode: string): string {\r\n  return path.join(util.getVortexPath('documents'), 'My Games', gameSupport.get(gameMode, 'mygamesPath'));\r\n}\r\n\r\nexport function iniName(gameMode: string): string {\r\n  return gameSupport.get(gameMode, 'iniName');\r\n}\r\n\r\nexport function iniPath(gameMode: string): string {\r\n  return path.join(mygamesPath(gameMode), gameSupport.get(gameMode, 'iniName'));\r\n}\r\n\r\nexport function archiveListKey(gameMode: string): string {\r\n  return gameSupport.get(gameMode, 'archiveListKey');\r\n}\r\n\r\nexport function defaultArchives(gameMode: string): string[] {\r\n  return gameSupport.get(gameMode, 'defaultArchives');\r\n}\r\n","import { bsaVersion, isSupported } from '../util/gameSupport';\n\nimport { toggleInvalidation } from '../bsaRedirection';\nimport { REDIRECTION_MOD } from '../constants';\n\nimport * as React from 'react';\nimport { ControlLabel, FormGroup, HelpBlock } from 'react-bootstrap';\nimport { withTranslation } from 'react-i18next';\nimport { connect } from 'react-redux';\nimport * as Redux from 'redux';\nimport { ComponentEx, selectors, Toggle, types } from 'vortex-api';\n\nexport interface IBaseProps {\n}\n\ninterface IConnectedProps {\n  gameMode: string;\n  mods: { [id: string]: types.IMod };\n}\n\ninterface IActionProps {\n}\n\ntype IProps = IBaseProps & IActionProps & IConnectedProps;\n\nclass Settings extends ComponentEx<IProps, {}> {\n  public render(): JSX.Element {\n    const { t, gameMode, mods } = this.props;\n\n    if (!isSupported(gameMode) || (bsaVersion(gameMode) === undefined)) {\n      return null;\n    }\n\n    return (\n      <form>\n        <FormGroup controlId='redirection'>\n          <ControlLabel>{t('Archive Invalidation')}</ControlLabel>\n          <Toggle\n            checked={(mods !== undefined) && (mods[REDIRECTION_MOD] !== undefined)}\n            onToggle={this.toggle}\n          >\n            {t('BSA redirection')}\n          </Toggle>\n          <HelpBlock>\n            {t('This adds a mod to vortex that provides Archive Invalidation '\n             + 'similar to mods like \"Archive Invalidation Invalidated\".')}\n          </HelpBlock>\n        </FormGroup>\n      </form>\n    );\n  }\n\n  private toggle = (enabled: boolean) => {\n    const { gameMode } = this.props;\n    toggleInvalidation(this.context.api, gameMode)\n    .then(() => null);\n  }\n}\n\nfunction mapStateToProps(state: types.IState): IConnectedProps {\n  const gameMode = selectors.activeGameId(state);\n  return {\n    gameMode,\n    mods: state.persistent.mods[gameMode],\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Redux.Dispatch<any>): IActionProps {\n  return {\n  };\n}\n\nexport default\n  withTranslation(['common'])(\n    connect(mapStateToProps, mapDispatchToProps)(Settings) as any,\n  ) as React.ComponentClass<{}>;\n","module.exports = require(\"bluebird\");","module.exports = require(\"path\");","module.exports = require(\"react\");","module.exports = require(\"react-bootstrap\");","module.exports = require(\"react-i18next\");","module.exports = require(\"react-redux\");","module.exports = require(\"vortex-api\");","module.exports = require(\"vortex-parse-ini\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.ts\");\n",""],"names":[],"sourceRoot":""}