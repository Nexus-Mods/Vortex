{"version":3,"file":"index.js","mappings":";;;;;;;;;;AAAa;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,oCAAoC,mBAAO,CAAC,oDAAmB;AAC/D,eAAe,mBAAO,CAAC,6BAAQ;AAC/B,mCAAmC,mBAAO,CAAC,0BAAU;AACrD,0BAA0B,mBAAO,CAAC,kBAAM;AACxC,qBAAqB,mBAAO,CAAC,8BAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA,oFAAoF,mBAAmB;AACvG,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yEAAyE,SAAS;AAClF;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sGAAsG,mBAAmB;AACzH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,oBAAoB;AAC1C;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,cAAc;AACtD,qGAAqG,oBAAoB;AACzH,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA,kBAAe;;;;;;;;;;;ACtLF;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,iBAAiB,GAAG,kBAAkB,GAAG,oBAAoB,GAAG,oBAAoB;AACpF,mCAAmC,mBAAO,CAAC,0BAAU;AACrD,0BAA0B,mBAAO,CAAC,kBAAM;AACxC,qBAAqB,mBAAO,CAAC,8BAAY;AACzC;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA;AACA,wDAAwD,mBAAmB;AAC3E,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,IAAI;AACjB;AACA;AACA,kEAAkE,OAAO;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA,iDAAiD,mBAAmB;AACpE,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA,wBAAwB,kDAAkD;AAC1E;AACA,SAAS;AACT,iGAAiG,mBAAmB;AACpH,KAAK;AACL;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,mDAAmD;AACnD;AACA,KAAK;AACL;AACA,2FAA2F,sBAAsB;AACjH,KAAK;AACL;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;;;;;;;;;;AC5GJ;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,2BAA2B,mBAAO,CAAC,oBAAO;AAC1C,0BAA0B,mBAAO,CAAC,wCAAiB;AACnD,oBAAoB,mBAAO,CAAC,4BAAW;AACvC,8BAA8B,mBAAO,CAAC,4BAAW;AACjD,qBAAqB,mBAAO,CAAC,8BAAY;AACzC;AACA;AACA;AACA;AACA,oBAAoB,uCAAuC;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mBAAmB;AACnC,+DAA+D,8EAA8E;AAC7I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,gBAAgB,iCAAiC;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,UAAU;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,sCAAsC;AACtD,gBAAgB,UAAU;AAC1B,+DAA+D,SAAS,uCAAuC;AAC/G,gIAAgI,wJAAwJ;AACxR;AACA;AACA;AACA;AACA,gBAAgB,iCAAiC;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;;;;;;;;;;;ACpKF;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,wCAAwC,mBAAO,CAAC,sDAAiB;AACjE,yCAAyC,mBAAO,CAAC,wDAAkB;AACnE,2BAA2B,mBAAO,CAAC,oBAAO;AAC1C,0BAA0B,mBAAO,CAAC,wCAAiB;AACnD,wBAAwB,mBAAO,CAAC,oCAAe;AAC/C,qBAAqB,mBAAO,CAAC,8BAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,oBAAoB,oBAAoB;AACxC;AACA;AACA,iEAAiE,yBAAyB;AAC1F,kEAAkE,uCAAuC;AACzG;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,IAAI;AACpB,gBAAgB,oBAAoB;AACpC;AACA;AACA,+DAA+D,6BAA6B;AAC5F;AACA,yEAAyE,SAAS,kBAAkB;AACpG,2EAA2E,aAAa;AACxF;AACA,mFAAmF,gBAAgB;AACnG;AACA;AACA;AACA,2FAA2F,iGAAiG;AAC5L;AACA,mFAAmF,gBAAgB;AACnG;AACA;AACA;AACA,2FAA2F,oGAAoG;AAC/L;AACA;AACA,gBAAgB,2BAA2B;AAC3C,kDAAkD;AAClD;AACA;AACA;AACA,qCAAqC,qDAAqD;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAe;;;;;;;;;;;AC7GF;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,2BAA2B,mBAAO,CAAC,oBAAO;AAC1C,0BAA0B,mBAAO,CAAC,wCAAiB;AACnD;AACA;AACA,gBAAgB,kBAAkB;AAClC;AACA;AACA;AACA;AACA,uEAAuE,8BAA8B;AACrG;AACA;AACA,kBAAe;;;;;;;;;;;ACrCf,qC;;;;;;;;;;ACAA,iC;;;;;;;;;;ACAA,kC;;;;;;;;;;ACAA,4C;;;;;;;;;;ACAA,sC;;;;;;;;;;ACAA,sC;;;;;;;;;;ACAA,0C;;;;;;;;;;ACAA,uC;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://game-pillarsofeternity2/./src/index.ts","webpack://game-pillarsofeternity2/./src/sync.ts","webpack://game-pillarsofeternity2/./src/views/DraggableList.tsx","webpack://game-pillarsofeternity2/./src/views/LoadOrder.tsx","webpack://game-pillarsofeternity2/./src/views/LoadOrderEntry.tsx","webpack://game-pillarsofeternity2/external commonjs2 \"bluebird\"","webpack://game-pillarsofeternity2/external commonjs2 \"path\"","webpack://game-pillarsofeternity2/external commonjs2 \"react\"","webpack://game-pillarsofeternity2/external commonjs2 \"react-bootstrap\"","webpack://game-pillarsofeternity2/external commonjs2 \"react-dnd\"","webpack://game-pillarsofeternity2/external commonjs2 \"react-dom\"","webpack://game-pillarsofeternity2/external commonjs2 \"react-i18next\"","webpack://game-pillarsofeternity2/external commonjs2 \"vortex-api\"","webpack://game-pillarsofeternity2/webpack/bootstrap","webpack://game-pillarsofeternity2/webpack/before-startup","webpack://game-pillarsofeternity2/webpack/startup","webpack://game-pillarsofeternity2/webpack/after-startup"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst LoadOrder_1 = __importDefault(require(\"./views/LoadOrder\"));\nconst sync_1 = require(\"./sync\");\nconst bluebird_1 = __importDefault(require(\"bluebird\"));\nconst path = __importStar(require(\"path\"));\nconst vortex_api_1 = require(\"vortex-api\");\nconst poe2LocalLowPath = path.resolve(vortex_api_1.util.getVortexPath('appData'), '..', 'LocalLow', 'Obsidian Entertainment', 'Pillars of Eternity II');\nconst tools = [];\nconst MODIFIABLE_WIN_APPS = 'modifiablewindowsapps';\nconst MS_ID = 'VersusEvil.PillarsofEternity2-PC';\nconst STEAM_ID = '560130';\nfunction genAttributeExtractor(api) {\n    return (modInfo, modPath) => {\n        const gameMode = vortex_api_1.selectors.activeGameId(api.store.getState());\n        if ((modPath === undefined) || (gameMode !== 'pillarsofeternity2')) {\n            return bluebird_1.default.resolve({});\n        }\n        return vortex_api_1.fs.readFileAsync(path.join(modPath, 'manifest.json'), { encoding: 'utf-8' })\n            .catch(() => '{}')\n            .then(jsonData => {\n            try {\n                const data = JSON.parse(vortex_api_1.util.deBOM(jsonData));\n                const res = {\n                    minGameVersion: vortex_api_1.util.getSafeCI(data, ['SupportedGameVersion', 'min'], '1.0'),\n                    maxGameVersion: vortex_api_1.util.getSafeCI(data, ['SupportedGameVersion', 'max'], '9.0'),\n                };\n                return res;\n            }\n            catch (err) {\n                (0, vortex_api_1.log)('warn', 'Invalid manifest.json', { modPath });\n                return {};\n            }\n        });\n    };\n}\nfunction findGame() {\n    return vortex_api_1.util.GameStoreHelper.findByAppId([STEAM_ID, MS_ID])\n        .catch(err => vortex_api_1.util.steam.findByName('Pillars of Eternity II: Deadfire'))\n        .then(game => game.gamePath);\n}\nfunction modPath(discoveryPath) {\n    return (discoveryPath.includes('ModifiableWindowsApps'))\n        ? path.join('PillarsOfEternity2_Data', 'override')\n        : path.join('PillarsOfEternityII_Data', 'override');\n}\nfunction modConfig() {\n    return path.join(poe2LocalLowPath, 'modconfig.json');\n}\nfunction prepareForModding(discovery) {\n    return createModConfigFile().then(() => vortex_api_1.fs.ensureDirWritableAsync(path.join(discovery.path, modPath(discovery.path))));\n}\nfunction createModConfigFile() {\n    return vortex_api_1.fs.statAsync(modConfig())\n        .then(st => bluebird_1.default.resolve())\n        .catch(err => {\n        if (err.code === 'ENOENT') {\n            return writeModConfigFile();\n        }\n        else {\n            return bluebird_1.default.reject(err);\n        }\n    });\n}\nfunction executable(discoveryPath) {\n    if (discoveryPath === undefined) {\n        return 'PillarsOfEternityII.exe';\n    }\n    else {\n        return (discoveryPath.toLowerCase().includes(MODIFIABLE_WIN_APPS))\n            ? 'PillarsOfEternity2.exe'\n            : 'PillarsOfEternityII.exe';\n    }\n}\nfunction writeModConfigFile() {\n    const data = {\n        Entries: [],\n    };\n    return vortex_api_1.fs.ensureFileAsync(modConfig())\n        .then(() => vortex_api_1.fs.writeFileAsync(modConfig(), JSON.stringify(data, undefined, 2), { encoding: 'utf-8' }));\n}\nfunction requiresLauncher(gamePath) {\n    return (gamePath.toLowerCase().includes(MODIFIABLE_WIN_APPS))\n        ? bluebird_1.default.resolve({\n            launcher: 'xbox',\n            addInfo: {\n                appId: MS_ID,\n                parameters: [\n                    { appExecName: 'App' },\n                ],\n            }\n        })\n        : bluebird_1.default.resolve(undefined);\n}\nconst emptyObj = {};\nfunction init(context) {\n    context.registerGame({\n        id: 'pillarsofeternity2',\n        name: 'Pillars Of Eternity II:\\tDeadfire',\n        mergeMods: false,\n        queryPath: findGame,\n        queryModPath: (discoveryPath) => modPath(discoveryPath),\n        logo: 'gameart.png',\n        executable,\n        requiresLauncher,\n        requiredFiles: [],\n        supportedTools: tools,\n        setup: prepareForModding,\n        environment: {\n            SteamAPPId: STEAM_ID,\n        },\n        details: {\n            steamAppId: +STEAM_ID,\n        },\n    });\n    context.registerMainPage('sort-none', 'Load Order', LoadOrder_1.default, {\n        id: 'pillars2-loadorder',\n        hotkey: 'E',\n        group: 'per-game',\n        visible: () => vortex_api_1.selectors.activeGameId(context.api.store.getState()) === 'pillarsofeternity2',\n        props: () => {\n            const state = context.api.store.getState();\n            return {\n                mods: state.persistent.mods['pillarsofeternity2'] || emptyObj,\n                profile: vortex_api_1.selectors.activeProfile(state),\n                loadOrder: (0, sync_1.getLoadOrder)(),\n                onSetLoadOrder: (order) => {\n                    (0, sync_1.setLoadOrder)(order);\n                },\n            };\n        },\n    });\n    context.registerAttributeExtractor(100, genAttributeExtractor(context.api));\n    context.once(() => {\n        context.api.events.on('gamemode-activated', (gameMode) => {\n            if (gameMode === 'pillarsofeternity2') {\n                (0, sync_1.startWatch)(context.api.store.getState())\n                    .catch(vortex_api_1.util.DataInvalid, err => {\n                    const errorMessage = 'Your mod configuration file is invalid, you must remove/fix '\n                        + 'this file for the mods to function correctly. The file is '\n                        + 'located in: '\n                        + '\"C:\\\\Users\\\\{YOUR_USERNAME}\\\\AppData\\\\LocalLow\\\\Obsidian Entertainment\\\\Pillars of Eternity II\\\\modconfig.json\"';\n                    context.api.showErrorNotification('Invalid modconfig.json file', errorMessage, { allowReport: false });\n                })\n                    .catch(err => {\n                    context.api.showErrorNotification('Failed to update modorder', err);\n                });\n            }\n            else {\n                (0, sync_1.stopWatch)();\n            }\n        });\n        context.api.setStylesheet('game-pillarsofeternity2', path.join(__dirname, 'stylesheet.scss'));\n    });\n    return true;\n}\nexports.default = init;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.stopWatch = exports.startWatch = exports.setLoadOrder = exports.getLoadOrder = void 0;\nconst bluebird_1 = __importDefault(require(\"bluebird\"));\nconst path = __importStar(require(\"path\"));\nconst vortex_api_1 = require(\"vortex-api\");\nconst poe2Path = path.resolve(vortex_api_1.util.getVortexPath('appData'), '..', 'LocalLow', 'Obsidian Entertainment', 'Pillars of Eternity II');\nlet watcher;\nlet loadOrder = vortex_api_1.util.makeReactive({});\nfunction modConfig() {\n    return path.join(poe2Path, 'modconfig.json');\n}\nfunction updateLoadOrder(tries = 3) {\n    return vortex_api_1.fs.readFileAsync(modConfig(), { encoding: 'utf-8' })\n        .catch(() => '{}')\n        .then(jsonData => {\n        try {\n            const data = JSON.parse(vortex_api_1.util.deBOM(jsonData));\n            loadOrder = (data.Entries || []).reduce((prev, entry, idx) => {\n                prev[entry.FolderName] = {\n                    pos: idx,\n                    enabled: entry.Enabled,\n                };\n                return prev;\n            }, {});\n        }\n        catch (err) {\n            (0, vortex_api_1.log)('debug', 'update load order', { tries });\n            if (tries > 0) {\n                return bluebird_1.default.delay(100).then(() => updateLoadOrder(tries - 1));\n            }\n            else {\n                return (err.message.indexOf('Unexpected token') !== -1)\n                    ? bluebird_1.default.reject(new vortex_api_1.util.DataInvalid('Invalid config file'))\n                    : bluebird_1.default.reject(err);\n            }\n        }\n    });\n}\nfunction getLoadOrder() {\n    return loadOrder;\n}\nexports.getLoadOrder = getLoadOrder;\nfunction setLoadOrder(order) {\n    loadOrder = order;\n    vortex_api_1.fs.readFileAsync(modConfig(), { encoding: 'utf-8' })\n        .catch(() => '{}')\n        .then(jsonData => {\n        const data = JSON.parse(vortex_api_1.util.deBOM(jsonData));\n        data.Entries = Object.keys(loadOrder)\n            .sort((lhs, rhs) => loadOrder[lhs].pos - loadOrder[rhs].pos)\n            .reduce((prev, key) => {\n            prev.push({ FolderName: key, Enabled: loadOrder[key].enabled });\n            return prev;\n        }, []);\n        return vortex_api_1.fs.writeFileAsync(modConfig(), JSON.stringify(data, undefined, 2), { encoding: 'utf-8' });\n    });\n}\nexports.setLoadOrder = setLoadOrder;\nfunction startWatch(state) {\n    const discovery = state.settings.gameMode.discovered['pillarsofeternity2'];\n    if (discovery === undefined) {\n        return bluebird_1.default.reject(new Error('Pillars of Eternity 2 wasn\\'t discovered'));\n    }\n    const loDebouncer = new vortex_api_1.util.Debouncer(() => {\n        return updateLoadOrder();\n    }, 200);\n    watcher = vortex_api_1.fs.watch(modConfig(), {}, () => {\n        loDebouncer.schedule();\n    });\n    watcher.on('error', err => {\n        (0, vortex_api_1.log)('error', 'failed to watch poe2 mod directory for changes', { message: err.message });\n    });\n    return updateLoadOrder();\n}\nexports.startWatch = startWatch;\nfunction stopWatch() {\n    if (watcher !== undefined) {\n        watcher.close();\n        watcher = undefined;\n    }\n}\nexports.stopWatch = stopWatch;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst React = __importStar(require(\"react\"));\nconst react_bootstrap_1 = require(\"react-bootstrap\");\nconst react_dnd_1 = require(\"react-dnd\");\nconst ReactDOM = __importStar(require(\"react-dom\"));\nconst vortex_api_1 = require(\"vortex-api\");\nclass DraggableItem extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.setRef = ref => {\n            const { connectDragSource, connectDropTarget } = this.props;\n            const node = ReactDOM.findDOMNode(ref);\n            connectDragSource(node);\n            connectDropTarget(node);\n        };\n    }\n    render() {\n        const { isDragging, item } = this.props;\n        return (React.createElement(this.props.itemRenderer, { className: isDragging ? 'dragging' : undefined, item: item, ref: this.setRef }));\n    }\n}\nconst DND_TYPE = 'poe2-plugin-entry';\nfunction collectDrag(connect, monitor) {\n    return {\n        connectDragSource: connect.dragSource(),\n        isDragging: monitor.isDragging(),\n    };\n}\nfunction collectDrop(connect, monitor) {\n    return {\n        connectDropTarget: connect.dropTarget(),\n    };\n}\nconst entrySource = {\n    beginDrag(props) {\n        return {\n            index: props.index,\n            item: props.item,\n            containerId: props.containerId,\n            take: (list) => props.take(props.item, list),\n        };\n    },\n    endDrag(props, monitor) {\n        props.apply();\n    },\n};\nconst entryTarget = {\n    hover(props, monitor, component) {\n        const { containerId, index, item, take } = monitor.getItem();\n        const hoverIndex = props.index;\n        if (index === hoverIndex) {\n            return;\n        }\n        const hoverBoundingRect = ReactDOM.findDOMNode(component).getBoundingClientRect();\n        const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n        const clientOffset = monitor.getClientOffset();\n        const hoverClientY = clientOffset.y - hoverBoundingRect.top;\n        if (((index < hoverIndex) && (hoverClientY < hoverMiddleY))\n            || ((index > hoverIndex) && (hoverClientY > hoverMiddleY))) {\n            return;\n        }\n        props.onChangeIndex(index, hoverIndex, containerId !== props.containerId, take);\n        monitor.getItem().index = hoverIndex;\n        if (containerId !== props.containerId) {\n            monitor.getItem().containerId = props.containerId;\n            monitor.getItem().take = (list) => props.take(item, list);\n        }\n    },\n    drop(props) {\n        props.apply();\n    },\n};\nconst Draggable = (0, react_dnd_1.DropTarget)(DND_TYPE, entryTarget, collectDrop)((0, react_dnd_1.DragSource)(DND_TYPE, entrySource, collectDrag)(DraggableItem));\nclass DraggableList extends vortex_api_1.ComponentEx {\n    constructor(props) {\n        super(props);\n        this.changeIndex = (oldIndex, newIndex, changeContainer, take) => {\n            if (oldIndex === undefined) {\n                return;\n            }\n            const copy = this.state.ordered.slice();\n            const item = take(changeContainer ? undefined : copy);\n            copy.splice(newIndex, 0, item);\n            this.nextState.ordered = copy;\n        };\n        this.take = (item, list) => {\n            const { ordered } = this.nextState;\n            let res = item;\n            const index = ordered.findIndex(iter => iter.id === item.id);\n            if (index !== -1) {\n                if (list !== undefined) {\n                    res = list.splice(index, 1)[0];\n                }\n                else {\n                    const copy = ordered.slice();\n                    res = copy.splice(index, 1)[0];\n                    this.nextState.ordered = copy;\n                }\n            }\n            return res;\n        };\n        this.apply = () => {\n            this.props.apply(this.state.ordered);\n        };\n        this.initState({\n            ordered: props.items.slice(0),\n        });\n        this.applyDebouncer = new vortex_api_1.util.Debouncer(() => {\n            this.apply();\n            return null;\n        }, 500);\n    }\n    UNSAFE_componentWillReceiveProps(newProps) {\n        if (this.props.items !== newProps.items) {\n            this.nextState.ordered = newProps.items.slice(0);\n        }\n    }\n    render() {\n        const { connectDropTarget, id, itemRenderer } = this.props;\n        const { ordered } = this.state;\n        return connectDropTarget((React.createElement(\"div\", { style: { overflow: 'auto', maxHeight: '100%' } },\n            React.createElement(react_bootstrap_1.ListGroup, null, ordered.map((item, idx) => (React.createElement(Draggable, { containerId: id, key: item.id, item: item, index: idx, itemRenderer: itemRenderer, take: this.take, onChangeIndex: this.changeIndex, apply: this.apply })))))));\n    }\n}\nconst containerTarget = {\n    hover(props, monitor, component) {\n        const { containerId, index, item, take } = monitor.getItem();\n        if (containerId !== props.id) {\n            component.changeIndex(index, 0, true, take);\n            monitor.getItem().index = 0;\n            monitor.getItem().containerId = props.id;\n            monitor.getItem().take = (list) => component.take(item, list);\n        }\n    },\n};\nfunction containerCollect(connect, monitor) {\n    return {\n        connectDropTarget: connect.dropTarget(),\n    };\n}\nexports.default = (0, react_dnd_1.DropTarget)(DND_TYPE, containerTarget, containerCollect)(DraggableList);\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst DraggableList_1 = __importDefault(require(\"./DraggableList\"));\nconst LoadOrderEntry_1 = __importDefault(require(\"./LoadOrderEntry\"));\nconst React = __importStar(require(\"react\"));\nconst react_bootstrap_1 = require(\"react-bootstrap\");\nconst react_i18next_1 = require(\"react-i18next\");\nconst vortex_api_1 = require(\"vortex-api\");\nconst PanelX = react_bootstrap_1.Panel;\nclass LoadOrder extends vortex_api_1.ComponentEx {\n    constructor(props) {\n        super(props);\n        this.applyEnabled = (ordered) => {\n            this.nextState.enabled = ordered;\n            this.nextState.disabled = this.state.disabled.filter(entry => ordered.find(item => item.id === entry.id) === undefined);\n            this.mWriteDebouncer.schedule();\n        };\n        this.applyDisabled = (ordered) => {\n            this.nextState.disabled = ordered;\n            this.nextState.enabled = this.state.enabled.filter(entry => ordered.find(item => item.id === entry.id) === undefined);\n            this.mWriteDebouncer.schedule();\n        };\n        this.initState({\n            enabled: [],\n            disabled: [],\n        });\n        this.mWriteDebouncer = new vortex_api_1.util.Debouncer(() => {\n            const { enabled, disabled } = this.state;\n            const newOrder = {};\n            const numEnabled = enabled.length;\n            enabled.forEach((item, idx) => newOrder[item.id] = { pos: idx, enabled: true });\n            disabled.forEach((item, idx) => newOrder[item.id] = { pos: numEnabled + idx, enabled: false });\n            this.props.onSetLoadOrder(newOrder);\n            return null;\n        }, 2000);\n    }\n    componentDidMount() {\n        this.updateState(this.props);\n    }\n    UNSAFE_componentWillReceiveProps(newProps) {\n        if ((this.props.loadOrder !== newProps.loadOrder)\n            || (this.props.mods !== newProps.mods)\n            || (this.props.profile !== newProps.profile)) {\n            this.updateState(newProps);\n        }\n    }\n    render() {\n        const { t } = this.props;\n        const { enabled, disabled } = this.state;\n        return (React.createElement(vortex_api_1.MainPage, null,\n            React.createElement(vortex_api_1.MainPage.Body, null,\n                React.createElement(react_bootstrap_1.Panel, { id: 'pillars2-plugin-panel' },\n                    React.createElement(PanelX.Body, null,\n                        React.createElement(vortex_api_1.DNDContainer, { style: { height: '100%' } },\n                            React.createElement(vortex_api_1.FlexLayout, { type: 'row' },\n                                React.createElement(vortex_api_1.FlexLayout.Flex, null,\n                                    React.createElement(vortex_api_1.FlexLayout, { type: 'column' },\n                                        React.createElement(vortex_api_1.FlexLayout.Fixed, null,\n                                            React.createElement(\"h4\", null, t('Enabled'))),\n                                        React.createElement(vortex_api_1.FlexLayout.Flex, null,\n                                            React.createElement(DraggableList_1.default, { id: 'enabled', items: enabled, itemRenderer: LoadOrderEntry_1.default, apply: this.applyEnabled })))),\n                                React.createElement(vortex_api_1.FlexLayout.Flex, null,\n                                    React.createElement(vortex_api_1.FlexLayout, { type: 'column' },\n                                        React.createElement(vortex_api_1.FlexLayout.Fixed, null,\n                                            React.createElement(\"h4\", null, t('Disabled'))),\n                                        React.createElement(vortex_api_1.FlexLayout.Flex, null,\n                                            React.createElement(DraggableList_1.default, { id: 'disabled', items: disabled, itemRenderer: LoadOrderEntry_1.default, apply: this.applyDisabled })))))))))));\n    }\n    updateState(props) {\n        const { mods, loadOrder, profile } = props;\n        const sorted = Object.keys(loadOrder || {})\n            .filter(lo => (mods[lo] !== undefined)\n            && vortex_api_1.util.getSafe(profile, ['modState', lo, 'enabled'], false))\n            .sort((lhs, rhs) => loadOrder[lhs].pos - loadOrder[rhs].pos);\n        const mapToItem = (id) => ({ id, name: vortex_api_1.util.renderModName(mods[id]) });\n        this.nextState.enabled = sorted\n            .filter(id => loadOrder[id].enabled)\n            .map(mapToItem);\n        this.nextState.disabled = [].concat(sorted.filter(id => !loadOrder[id].enabled), Object.keys(mods)\n            .filter(id => (loadOrder[id] === undefined)\n            && vortex_api_1.util.getSafe(profile, ['modState', id, 'enabled'], false))).map(mapToItem);\n    }\n}\nexports.default = (0, react_i18next_1.withTranslation)(['common', 'game-pillarsofeternity2'])(LoadOrder);\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst React = __importStar(require(\"react\"));\nconst react_bootstrap_1 = require(\"react-bootstrap\");\nclass PluginEntry extends React.Component {\n    render() {\n        const { className, item } = this.props;\n        let classes = ['plugin-entry'];\n        if (className !== undefined) {\n            classes = classes.concat(className.split(' '));\n        }\n        return (React.createElement(react_bootstrap_1.ListGroupItem, { className: classes.join(' ') }, item.name));\n    }\n}\nexports.default = PluginEntry;\n","module.exports = require(\"bluebird\");","module.exports = require(\"path\");","module.exports = require(\"react\");","module.exports = require(\"react-bootstrap\");","module.exports = require(\"react-dnd\");","module.exports = require(\"react-dom\");","module.exports = require(\"react-i18next\");","module.exports = require(\"vortex-api\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.ts\");\n",""],"names":[],"sourceRoot":""}